<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试数据 - 本地特色农产品直销系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/index.html">本地特色农产品直销系统</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html">首页</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/pages/products.html">产品列表</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/pages/farmers.html">农户展示</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/pages/about.html">关于我们</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/pages/test-data.html">测试数据</a>
                    </li>
                </ul>
                
                <!-- 未登录菜单 -->
                <div id="unauthenticated-menu">
                    <a href="/pages/login.html" class="btn btn-outline-primary me-2">登录</a>
                    <a href="/pages/register.html" class="btn btn-primary">注册</a>
                </div>
                
                <!-- 已登录菜单 -->
                <div id="authenticated-menu" class="d-none">
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                            <span id="username">用户</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/pages/user-profile.html">个人中心</a></li>
                            <li><a class="dropdown-item" href="/pages/user-orders.html">我的订单</a></li>
                            <li id="admin-menu-item" class="d-none"><a class="dropdown-item" href="/pages/admin-dashboard.html">管理控制台</a></li>
                            <li id="farmer-menu-item" class="d-none"><a class="dropdown-item" href="/pages/farmer-dashboard.html">农户管理</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logout-button">退出登录</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <div class="container mt-5">
        <h1 class="mb-4">测试数据生成</h1>
        
        <div class="alert alert-warning">
            此页面仅供测试使用，可以快速添加测试数据。
        </div>
        
        <div class="row">
            <!-- 注册测试用户 -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">注册测试用户</h5>
                    </div>
                    <div class="card-body">
                        <form id="test-user-form">
                            <div class="mb-3">
                                <label for="username" class="form-label">用户名</label>
                                <input type="text" class="form-control" id="test-username" value="testuser">
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">密码</label>
                                <input type="password" class="form-control" id="test-password" value="123456">
                            </div>
                            <div class="mb-3">
                                <label for="role" class="form-label">角色</label>
                                <select class="form-select" id="test-role">
                                    <option value="user">普通用户</option>
                                    <option value="farmer">农户</option>
                                    <option value="admin">管理员</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary w-100" onclick="registerTestUser()">注册测试用户</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- 添加测试产品 -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">添加测试产品</h5>
                    </div>
                    <div class="card-body">
                        <form id="test-product-form">
                            <div class="mb-3">
                                <label for="product-name" class="form-label">产品名称</label>
                                <input type="text" class="form-control" id="product-name" value="本地有机蔬菜">
                            </div>
                            <div class="mb-3">
                                <label for="product-price" class="form-label">价格</label>
                                <input type="number" class="form-control" id="product-price" value="29.9" step="0.1">
                            </div>
                            <div class="mb-3">
                                <label for="product-stock" class="form-label">库存</label>
                                <input type="number" class="form-control" id="product-stock" value="100">
                            </div>
                            <div class="mb-3">
                                <label for="product-description" class="form-label">描述</label>
                                <textarea class="form-control" id="product-description" rows="3">新鲜采摘的本地有机蔬菜，无农药，无化肥，健康美味。</textarea>
                            </div>
                            <div class="mb-3">
                                <label for="product-image" class="form-label">图片URL</label>
                                <input type="text" class="form-control" id="product-image" value="https://via.placeholder.com/400x300">
                            </div>
                            <div class="mb-3">
                                <label for="product-farmer" class="form-label">农户ID</label>
                                <input type="number" class="form-control" id="product-farmer" value="1">
                                <div class="form-text">需要先创建农户用户，然后使用其用户ID</div>
                            </div>
                            <button type="button" class="btn btn-success w-100" onclick="addTestProduct()">添加测试产品</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- 快速生成多条测试数据 -->
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="card-title mb-0">批量生成测试数据</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <button type="button" class="btn btn-info w-100" onclick="createSampleFarmers()">生成5个测试农户</button>
                            </div>
                            <div class="col-md-6 mb-3">
                                <button type="button" class="btn btn-info w-100" onclick="createSampleProducts()">生成10个测试产品</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 执行结果 -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="card-title mb-0">执行结果</h5>
                    </div>
                    <div class="card-body">
                        <div id="result-container" class="bg-light p-3 rounded" style="max-height: 300px; overflow-y: auto;">
                            <p class="text-muted">操作结果将显示在这里...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-light py-4 mt-5">
        <div class="container">
            <p class="text-center text-muted mb-0">© 2023 本地特色农产品直销系统. 保留所有权利.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/api.js"></script>
    <script>
        // 检查用户登录状态
        function checkAuthStatus() {
            const token = localStorage.getItem('token');
            let user = null;
            try {
                user = JSON.parse(localStorage.getItem('user') || '{}');
            } catch (e) {
                console.error('解析user数据失败', e);
                localStorage.removeItem('user'); // 清除错误的数据
                user = {};
            }
            
            if (token && user && user.userId) {
                // 调试信息
                if (window.location.hostname === 'localhost') {
                    console.log('登录状态', {token: token.substring(0, 10) + '...', user});
                }
                
                // 设置已登录用户信息
                document.getElementById('username').textContent = user.username || '用户';
                
                // 已登录
                document.getElementById('unauthenticated-menu').classList.add('d-none');
                document.getElementById('authenticated-menu').classList.remove('d-none');
                
                // 根据角色显示/隐藏管理入口
                if (user.role === 'admin') {
                    document.getElementById('admin-menu-item').classList.remove('d-none');
                } else if (user.role === 'farmer') {
                    document.getElementById('farmer-menu-item').classList.remove('d-none');
                }
            } else {
                // 未登录
                document.getElementById('unauthenticated-menu').classList.remove('d-none');
                document.getElementById('authenticated-menu').classList.add('d-none');
                document.getElementById('admin-menu-item').classList.add('d-none');
                document.getElementById('farmer-menu-item').classList.add('d-none');
            }
        }
        
        // 退出登录
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/index.html';
        }
        
        // 添加结果消息
        function addResultMessage(message, isSuccess = true) {
            const resultContainer = document.getElementById('result-container');
            const messageElement = document.createElement('div');
            messageElement.className = isSuccess ? 'alert alert-success mb-2' : 'alert alert-danger mb-2';
            messageElement.textContent = message;
            resultContainer.prepend(messageElement);
        }
        
        // 注册测试用户
        async function registerTestUser() {
            const username = document.getElementById('test-username').value;
            const password = document.getElementById('test-password').value;
            const role = document.getElementById('test-role').value;
            
            if (!username || !password) {
                addResultMessage('用户名和密码不能为空', false);
                return;
            }
            
            try {
                const response = await api.auth.register({
                    username,
                    password,
                    role
                });
                
                if (response.code === 200) {
                    addResultMessage(`测试用户 ${username} (${role}) 注册成功！用户ID: ${response.data.userId}`);
                } else {
                    addResultMessage(`注册失败: ${response.message}`, false);
                }
            } catch (error) {
                addResultMessage(`注册错误: ${error.message}`, false);
            }
        }
        
        // 添加测试产品
        async function addTestProduct() {
            const token = localStorage.getItem('token');
            if (!token) {
                addResultMessage('请先登录后再添加产品', false);
                return;
            }
            
            const productName = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const stock = parseInt(document.getElementById('product-stock').value);
            const description = document.getElementById('product-description').value;
            const imageUrl = document.getElementById('product-image').value;
            const farmerId = parseInt(document.getElementById('product-farmer').value);
            
            if (!productName || isNaN(price) || isNaN(stock) || !description || !farmerId) {
                addResultMessage('请填写所有必填字段', false);
                return;
            }
            
            try {
                const response = await api.products.add({
                    productName,
                    price,
                    stock,
                    description,
                    imageUrl,
                    farmerId
                });
                
                if (response.code === 200) {
                    addResultMessage(`产品 ${productName} 添加成功！产品ID: ${response.data.productId}`);
                } else {
                    addResultMessage(`添加失败: ${response.message}`, false);
                }
            } catch (error) {
                addResultMessage(`添加错误: ${error.message}`, false);
            }
        }
        
        // 批量创建测试农户
        async function createSampleFarmers() {
            const farmers = [
                { username: 'farmer1', password: '123456', role: 'farmer' },
                { username: 'farmer2', password: '123456', role: 'farmer' },
                { username: 'farmer3', password: '123456', role: 'farmer' },
                { username: 'farmer4', password: '123456', role: 'farmer' },
                { username: 'farmer5', password: '123456', role: 'farmer' }
            ];
            
            let successCount = 0;
            
            for (const farmer of farmers) {
                try {
                    const response = await api.auth.register(farmer);
                    if (response.code === 200) {
                        successCount++;
                        addResultMessage(`农户 ${farmer.username} 创建成功！用户ID: ${response.data.userId}`);
                    } else {
                        addResultMessage(`农户 ${farmer.username} 创建失败: ${response.message}`, false);
                    }
                } catch (error) {
                    addResultMessage(`农户 ${farmer.username} 创建错误: ${error.message}`, false);
                }
            }
            
            addResultMessage(`批量创建农户完成，成功: ${successCount}，失败: ${farmers.length - successCount}`);
        }
        
        // 批量创建测试产品
        async function createSampleProducts() {
            const token = localStorage.getItem('token');
            if (!token) {
                addResultMessage('请先登录后再添加产品', false);
                return;
            }
            
            // 获取现有农户
            let farmerIds = [];
            try {
                // 这里假设有个API可以获取所有农户，如果没有，可以手动指定一些ID
                farmerIds = [1, 2, 3, 4, 5]; // 假设这些ID存在
            } catch (error) {
                addResultMessage('获取农户列表失败，将使用默认农户ID', false);
                farmerIds = [1]; // 使用默认的农户ID
            }
            
            const products = [
                { productName: '有机红薯', price: 12.5, stock: 200, description: '新鲜采摘的有机红薯，口感香甜', imageUrl: 'https://via.placeholder.com/400x300?text=Sweet+Potato' },
                { productName: '本地大米', price: 35.8, stock: 150, description: '本地种植的优质大米，颗粒饱满', imageUrl: 'https://via.placeholder.com/400x300?text=Rice' },
                { productName: '新鲜土鸡蛋', price: 25.0, stock: 300, description: '散养土鸡下的新鲜鸡蛋，营养丰富', imageUrl: 'https://via.placeholder.com/400x300?text=Eggs' },
                { productName: '野生蜂蜜', price: 78.0, stock: 50, description: '纯天然野生蜂蜜，无添加剂', imageUrl: 'https://via.placeholder.com/400x300?text=Honey' },
                { productName: '新鲜山楂', price: 15.9, stock: 120, description: '应季采摘的新鲜山楂，酸甜可口', imageUrl: 'https://via.placeholder.com/400x300?text=Hawthorn' },
                { productName: '自制豆腐', price: 8.5, stock: 80, description: '传统工艺制作的豆腐，口感嫩滑', imageUrl: 'https://via.placeholder.com/400x300?text=Tofu' },
                { productName: '农家腊肉', price: 68.0, stock: 40, description: '农家自制腊肉，香味浓郁', imageUrl: 'https://via.placeholder.com/400x300?text=Bacon' },
                { productName: '手工红糖', price: 32.0, stock: 60, description: '纯天然手工红糖，甜而不腻', imageUrl: 'https://via.placeholder.com/400x300?text=Brown+Sugar' },
                { productName: '农家自制酱菜', price: 18.5, stock: 90, description: '传统工艺腌制的酱菜，开胃爽口', imageUrl: 'https://via.placeholder.com/400x300?text=Pickles' },
                { productName: '有机萝卜', price: 5.5, stock: 250, description: '新鲜有机萝卜，脆嫩多汁', imageUrl: 'https://via.placeholder.com/400x300?text=Radish' },
            ];
            
            let successCount = 0;
            
            for (const product of products) {
                // 随机选择一个农户ID
                const farmerId = farmerIds[Math.floor(Math.random() * farmerIds.length)];
                
                try {
                    const response = await api.products.add({
                        ...product,
                        farmerId
                    });
                    
                    if (response.code === 200) {
                        successCount++;
                        addResultMessage(`产品 ${product.productName} 添加成功！产品ID: ${response.data.productId}`);
                    } else {
                        addResultMessage(`产品 ${product.productName} 添加失败: ${response.message}`, false);
                    }
                } catch (error) {
                    addResultMessage(`产品 ${product.productName} 添加错误: ${error.message}`, false);
                }
                
                // 添加延迟，避免请求过快
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            addResultMessage(`批量创建产品完成，成功: ${successCount}，失败: ${products.length - successCount}`);
        }
        
        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', function() {
            // 检查用户登录状态
            checkAuthStatus();
            
            // 设置登出按钮事件
            document.getElementById('logout-button').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
        });
    </script>
</body>
</html> 
 
 