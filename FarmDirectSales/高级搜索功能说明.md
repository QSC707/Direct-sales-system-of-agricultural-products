# 农户订单管理 - 高级搜索功能

## 功能概述

订单搜索功能已全面升级，新增了搜索模式选择、搜索范围选择等高级选项，并进行了性能优化。

## 🆕 新增功能

### 1. 搜索模式选择
- **模糊搜索**：支持部分匹配，如搜索"苹果"可找到"红富士苹果"
- **精确搜索**：仅精确匹配，如搜索"苹果"只能找到商品名为"苹果"的订单

### 2. 搜索范围选择
- **全部搜索**：同时搜索订单号、客户名称、商品名称
- **仅订单号**：只搜索订单号字段
- **仅客户名称**：只搜索客户用户名字段
- **仅商品名称**：只搜索商品名称字段

### 3. 性能优化
- 添加分页支持（单页最多100条记录）
- 添加搜索关键词长度限制（最多100字符）
- 优化数据库查询逻辑
- 添加参数验证和安全检查

## 📋 使用方法

### 基础搜索
1. 在搜索框中输入关键词
2. 点击搜索按钮或按Enter键
3. 查看搜索结果

### 高级搜索
1. 点击搜索框右侧的设置按钮（齿轮图标）
2. 在下拉菜单中选择：
   - **搜索范围**：选择要搜索的字段类型
   - **搜索模式**：开启或关闭模糊搜索
3. 点击"应用设置"按钮
4. 输入关键词并搜索

## 🎯 使用场景示例

### 场景1：精确查找订单
- **目标**：查找订单号为1001的订单
- **设置**：搜索范围选择"仅订单号"，关闭模糊搜索
- **搜索**：输入"1001"
- **结果**：只显示订单号为1001的订单

### 场景2：查找某类商品的所有订单
- **目标**：查找所有包含"苹果"的商品订单
- **设置**：搜索范围选择"仅商品名称"，开启模糊搜索
- **搜索**：输入"苹果"
- **结果**：显示所有商品名包含"苹果"的订单（如"红富士苹果"、"青苹果"等）

### 场景3：查找特定客户的订单
- **目标**：查找客户"张三"的所有订单
- **设置**：搜索范围选择"仅客户名称"，关闭模糊搜索
- **搜索**：输入"张三"
- **结果**：只显示客户名为"张三"的订单

### 场景4：模糊查找客户
- **目标**：查找所有姓"王"的客户订单
- **设置**：搜索范围选择"仅客户名称"，开启模糊搜索
- **搜索**：输入"王"
- **结果**：显示所有客户名包含"王"字的订单

## 🔧 技术特性

### 前端优化
- 实时更新搜索提示文本
- 保持批量模式状态在搜索时不丢失
- 智能的搜索选项重置
- 响应式的搜索界面设计

### 后端优化
- **参数验证**：
  - 搜索关键词最大长度限制：100字符
  - 分页大小限制：1-100条/页
  - 页码验证：最小为1
- **性能优化**：
  - 使用Entity Framework的分页查询
  - 避免不必要的数据库连接
  - 优化查询条件构建
- **安全性**：
  - 防止SQL注入攻击
  - 输入参数清理和验证
  - 查询结果限制

### API响应格式
```json
{
  "code": 200,
  "message": "获取订单列表成功",
  "data": [...],
  "pagination": {
    "currentPage": 1,
    "pageSize": 50,
    "totalCount": 120,
    "totalPages": 3,
    "hasNext": true,
    "hasPrevious": false
  }
}
```

## 🎨 界面说明

### 搜索配置面板
- **位置**：搜索框右侧的齿轮图标下拉菜单
- **宽度**：280px，包含所有搜索选项
- **功能**：
  - 搜索范围选择（单选按钮）
  - 模糊搜索开关（切换开关）
  - 应用设置按钮

### 搜索提示
- **动态提示**：根据搜索设置自动更新占位符文本
- **帮助文本**：显示当前搜索模式的说明

### 筛选信息栏
- **显示内容**：当前生效的所有筛选条件
- **格式**：`状态 [货到付款待处理] 商品搜索 [苹果] (模糊搜索) 日期 [2024-01-01 - 2024-01-31]`

## 🚀 性能提升

### 查询优化
- **分页查询**：避免一次性加载大量数据
- **索引建议**：建议在以下字段添加数据库索引：
  - Orders.CreateTime（已有，用于排序）
  - Orders.Status（筛选优化）
  - Users.Username（搜索优化）
  - Products.ProductName（搜索优化）

### 前端优化
- **事件防抖**：搜索框输入事件防抖处理
- **状态保持**：搜索设置在页面会话内保持
- **智能加载**：只在需要时重新加载数据

## 🔄 向后兼容

- 原有的搜索方式完全兼容
- 默认设置为"全部搜索"+"精确搜索"，与之前行为一致
- API保持向后兼容，新参数为可选参数

## 📱 响应式设计

- 搜索配置面板在移动设备上自动调整
- 保持良好的用户体验在各种屏幕尺寸下

## 🎯 未来规划

- [ ] 添加搜索历史记录
- [ ] 支持正则表达式搜索
- [ ] 添加搜索结果高亮显示
- [ ] 实现搜索建议/自动完成功能
- [ ] 添加搜索结果导出功能 