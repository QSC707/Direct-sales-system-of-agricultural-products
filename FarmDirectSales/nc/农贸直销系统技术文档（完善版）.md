## 农贸直销系统技术文档（完善版）

### 一、系统概述

本系统为“本地特色农产品直销管理系统”（简称“农贸直销系统”），采用前后端分离架构，旨在通过信息化手段连接本地农户与消费者，提供产品展示、在线订购、订单管理、图片上传、溯源查询等功能。

---

### 二、系统架构

- 架构模式：B/S 架构 + 前后端分离
    
- 前端：HTML、CSS、JavaScript（或 Bootstrap）
    
- 后端：ASP.NET Core Web API，C#语言
    
- 数据库：SQL Server
    
- 前后端交互方式：Ajax（使用 JSON 格式传输数据）
    
- 鉴权方式：基于 Cookie 的认证方案
    

---

### 三、用户角色与权限

|角色|权限描述|
|---|---|
|普通用户|注册/登录、浏览商品、下单、查看订单、提交反馈|
|农户用户|发布产品、管理库存、查看订单、发货处理|
|管理员|用户管理、产品审核、订单管理、数据统计、权限分配|

---

### 四、系统模块

#### 前台功能模块：

- 用户注册/登录
    
- 产品浏览与分类筛选
    
- 商品详情页
    
- 下单/支付/订单管理
    
- 留言与反馈
    

#### 后台管理模块：

- 用户管理（增删改查）
    
- 产品管理（添加、修改、删除、审核）
    
- 订单管理（查看、发货、确认）
    
- 图片上传与展示（支持多图）
    
- 数据统计（订单量、销售额等）
    

#### 新增建议模块：

- 溯源信息模块：展示农产品来源、种植/养殖环境信息，提升消费者信任感。
    
- 日志审计模块：记录用户与管理员的关键操作行为，提升系统安全性与可追溯性。
    

---

### 五、数据库设计

#### 表结构（核心字段）

- Users（用户表）
    
    - UserId（主键）
        
    - Username
        
    - Password
        
    - Role（普通用户/农户/管理员）
        
- Products（产品表）
    
    - ProductId（主键）
        
    - ProductName
        
    - Description
        
    - Price
        
    - Stock
        
    - ImageUrl
        
    - FarmerId（外键）
        
- Orders（订单表）
    
    - OrderId（主键）
        
    - UserId（外键）
        
    - ProductId
        
    - Quantity
        
    - TotalPrice
        
    - Status（未支付、待发货、已完成）
        
- Uploads（图片表）
    
    - UploadId（主键）
        
    - FilePath
        
    - LinkedProductId
        
    - UploadTime
        
- Traces（溯源表）
    
    - TraceId（主键）
        
    - ProductId（外键）
        
    - SourceInfo（如种植地、养殖地、日期等）
        
- Logs（日志表）
    
    - LogId（主键）
        
    - UserId（外键）
        
    - ActionType（操作类型）
        
    - ActionTime
        
    - Description
        

---

### 六、接口文档（部分示例）

#### 登录接口

- 地址：`POST /api/auth/login`
    
- 请求参数：
    

```
{
  "username": "user1",
  "password": "123456"
}
```

- 响应格式：
    

```
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "userId": 1,
    "role": "admin"
  }
}
```

#### 获取产品列表

- 地址：`GET /api/products`
    
- 请求参数：无
    
- 响应格式：见统一返回格式
    

#### 新增接口建议

- 获取产品溯源信息：`GET /api/traces/{productId}`
    
- 获取用户操作日志：`GET /api/logs?userId=xxx`
    

---

### 七、接口统一返回格式

所有接口返回以下格式：

```
{
  "code": 200,
  "message": "成功",
  "data": { }
}
```

|   |   |   |
|---|---|---|
|字段|类型|说明|
|code|int|状态码，如200成功，401未登录，403禁止，500服务器错误|
|message|string|操作说明信息|
|data|object/array|真实数据内容|

---

### 八、常见错误码规范

|   |   |
|---|---|
|code|描述|
|200|成功|
|400|请求参数错误|
|401|未认证（未登录或 Cookie 失效）|
|403|权限不足（非管理员访问管理接口）|
|404|接口不存在|
|500|系统内部错误|

---

### 九、认证与权限说明

- 登录成功后，后端通过 Cookie 保存身份信息。
    
- 所有接口统一通过中间件进行身份与权限验证：
    
    - 若无登录信息，返回401
        
    - 若角色权限不足，返回403
        
- 前端通过 Ajax 请求携带 Cookie，实现自动鉴权
    

---

### 十、项目目录结构（后端）

```
├── Controllers
│   ├── AuthController.cs
│   ├── ProductController.cs
│   ├── OrderController.cs
│   ├── TraceController.cs
│   └── LogController.cs
├── Models
│   └── *.cs
├── Services
│   └── *.cs
├── Data
│   └── ApplicationDbContext.cs
├── Middlewares
│   └── AuthMiddleware.cs
├── Program.cs
└── Startup.cs
```

---

### 十一、数据库ER关系图（逻辑结构）

（建议使用 dbdiagram.io 工具生成，暂略）

- 一个用户可以下多个订单
    
- 一个订单只属于一个用户
    
- 一个农户可以有多个产品
    
- 一个产品可能有多张图片（Uploads）
    
- 一个产品拥有一条或多条溯源记录（Traces）
    
- 一个用户产生多个日志记录（Logs）
    

---

### 十二、开发计划建议

|   |   |
|---|---|
|周次|开发内容|
|第1周|完成数据库建表，接口返回格式，用户注册/登录/权限拦截功能|
|第2周|产品展示、产品上传接口、前端页面初步成型|
|第3周|订单下单流程开发，订单管理模块、支付模拟|
|第4周|后台管理系统界面开发，图片上传模块、溯源信息管理模块|
|第5周|日志模块、联调测试、BUG修复、部署上线|

---

### 十三、非功能性要求

- 响应式设计，适配 PC 和移动端
    
- 后端接口高容错，支持异常处理与错误码提示
    
- 使用 Cookie 简化登录机制
    
- 图片上传支持大小限制与格式校验
    
- 系统模块应支持日志记录与审计能力
    
- 溯源信息需支持展示并关联产品信息，提升透明度与信任度
    

---

### 结语

通过以上完善的技术文档与开发计划安排，本项目具备良好的可开发性、可维护性与扩展性，能够较快完成农贸直销平台系统的整体开发与部署，并通过溯源与日志等增强功能，进一步提升系统的安全性、透明性与用户信任。